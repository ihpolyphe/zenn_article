---
title: "Stable Audio Openã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰éŸ³æ¥½ç”Ÿæˆã‚’è©¦ã—ã¦ã¿ãŸ"
emoji: "ðŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Stable Audio Open", "Prompt Programing", "Music"]
published: true
published_at: "2024-6-13"
---
# ã¯ã˜ã‚ã«
`stable diffusion`ãŒä¸€ä¸–ã‚’é¢¨é¡ã—ã¦ã„ã¾ã—ãŸãŒã€ãã®éŸ³æ¥½ç‰ˆãƒ¢ãƒ‡ãƒ«ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã¨ã„ã†ã“ã¨ã§ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚

ç°¡å˜ã«ä½¿ã†ã¨ã“ã‚ã¾ã§ã¯ã§ããŸã®ã§ã²ã¨ã¾ãšæœ¬è¨˜äº‹ã«ã¾ã¨ã‚ã¾ã™ã€‚ãŸã ã€`stable diffusion`ã§ã‚‚ãã†ã§ã—ãŸãŒã€æœ¬ç•ªã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦æœŸå¾…é€šã‚Šã®å‡ºåŠ›ï¼ˆä»Šå›žã¯éŸ³æ¥½ï¼‰ã‚’å¾—ã‚‹ã“ã¨ã ã¨æ€ã†ã®ã§ã€ãã‚Œã«ã¤ã„ã¦ã¯ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã¦ã¾ãŸè¨˜äº‹ã«ã¾ã¨ã‚ã‚‰ã‚Œã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

[stable-audio-open-1.0](https://huggingface.co/stabilityai/stable-audio-open-1.0)

# å®Ÿè¡Œç’°å¢ƒ
ç’°å¢ƒ
WSL2ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚ä»Šå›žã¯ã»ã‹ã®ç’°å¢ƒã‚’æ±šã—ãŸããªã„ã®ã§`venv`ã‚’ä½¿ç”¨ã—ã¦pipã§ç’°å¢ƒæ§‹ç¯‰ã—ã¾ã—ãŸã€‚(condaã‚’ä½¿ç”¨ã—ãŸã‚Šç’°å¢ƒãã¡ã‚ƒãã¡ã‚ƒãªã®ã§ãã®ã†ã¡æ•´ç†ã—ãŸã„ã€‚ã€‚ã€‚)

ãƒ›ã‚¹ãƒˆOS: Windows11
WSL2: 5.10.16.3-microsoft-standard-WSL2(Ubuntu 20.04)
CPU: 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz 2.30 GHz
GPU:NVIDIA GeForce RTX 3050 Ti Laptop GPU

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
### ä»®æƒ³ç’°å¢ƒæ§‹ç¯‰
ã¾ãšã¯ä»®æƒ³ç’°å¢ƒ(`venv`)ã®æ§‹ç¯‰ã‚’è¡Œã„ã¾ã™ã€‚["Pythonã®ç’°å¢ƒæ§‹ç¯‰ã‚’ãƒžã‚¹ã‚¿ãƒ¼ã™ã‚‹(pyenv,venv)(WSL2,Ubuntuåˆ©ç”¨)(poetryè¿½è¨˜)"](https://zenn.dev/tigrebiz/articles/2822fb4de256d8)ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ç§»å‹•ã—ã¦æ–°ã—ã„ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ã€‚
```
mkdir stable-audio-open
cd stable-audio-open
python -m venv stable-audio-open
```

ä»®æƒ³ç’°å¢ƒã®ä½œæˆã«æˆåŠŸã—ãŸã‚‰ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã§ä»®æƒ³ç’°å¢ƒã‚’activateã—ã¾ã™ã€‚ç„¡äº‹ä»®æƒ³ç’°å¢ƒã‚’activateã§ããŸã‚‰pipã‚’ä¸€å¿œupgradeã—ã¦ãŠãã¾ã—ãŸã€‚
```
source stable-audio-open/bin/activate
pip install --upgrade pip
```

### stable audio toolsã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
`stable audio open`ã¯[`stable-audio-tools`](https://github.com/Stability-AI/stable-audio-tools)ã«å«ã¾ã‚Œã‚‹ã®ã§å…¬å¼README.mdã«å¾“ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ãŒã€inferenceã™ã‚‹ãŸã‚ã«ã¯å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã“ã¡ã‚‰ã¯ã„ã‚‰ãªã„ã®ã‹ã‚‚ï¼Ÿ
```
pip install stable-audio-tools
```
inferenceã™ã‚‹ãŸã‚ã«ã¯å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ä»¥ä¸‹ã¯å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚
```
git clone https://github.com/Stability-AI/stable-audio-tools.git
cd stable-audio-tools
pip install .
```

### Huggingfaceãƒ­ã‚°ã‚¤ãƒ³
`stable audio open`ã¯`Huggingface`ã«ã‚ˆã£ã¦ãƒ¢ãƒ‡ãƒ«ãŒç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ãªã„ã¨ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã§ããªã„ã§ã™ã€‚

https://huggingface.co/stabilityai/stable-audio-open-1.0ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨`stable audio open`ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ç™»éŒ²ãªã©ãŒã‚ã‚Šã¾ã™ã®ã§ã€å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

ã¾ãŸã€ãƒ¢ãƒ‡ãƒ«ã®ä½¿ç”¨æ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆGitHubã®PATã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã­ï¼‰ã€‚

ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—æ–¹æ³•ã¯ã‚°ã‚°ã‚Œã°å‡ºã¦ãã‚‹ã®ã§ã“ã“ã§ã¯å‰²æ„›ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šæ–¹æ³•ã¯ã€è‡ªåˆ†ã®æ–¹æ³•ãŒæ­£ã—ã„ã¨ã¯æ€ã£ã¦ãªã„ã§ã™ãŒã€ä»¥ä¸‹ã®æ–¹æ³•ã§è¨­å®šã§ãã¾ã—ãŸã€‚

æ™®é€šã«pythonã‹ã‚‰è¨­å®šã—ãŸæ„Ÿã˜ã§ã™ã­ã€‚

```
(stable-audio-open) (base) user:~/stable-audio-open$ python
Python 3.10.9 (main, Mar  1 2023, 18:23:06) [GCC 11.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from huggingface_hub import login
>>> login()

    _|    _|  _|    _|    _|_|_|    _|_|_|  _|_|_|  _|      _|    _|_|_|      _|_|_|_|    _|_|      _|_|_|  _|_|_|_|
    _|    _|  _|    _|  _|        _|          _|    _|_|    _|  _|            _|        _|    _|  _|        _|
    _|_|_|_|  _|    _|  _|  _|_|  _|  _|_|    _|    _|  _|  _|  _|  _|_|      _|_|_|    _|_|_|_|  _|        _|_|_|
    _|    _|  _|    _|  _|    _|  _|    _|    _|    _|    _|_|  _|    _|      _|        _|    _|  _|        _|
    _|    _|    _|_|      _|_|_|    _|_|_|  _|_|_|  _|      _|    _|_|_|      _|        _|    _|    _|_|_|  _|_|_|_|

    To login, `huggingface_hub` requires a token generated from https://huggingface.co/settings/tokens .
Enter your token (input will not be visible):
Add token as git credential? (Y/n) y
Token is valid (permission: read).

Token has not been saved to git credential helper.
Your token has been saved to /home/user/.cache/huggingface/token
Login successful
```

## pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦æ›²ã‚’ç”Ÿæˆ
ã“ã“ã¾ã§ãã‚Œã°ã‚ã¨ã¯æ›²ã‚’ç”Ÿæˆã™ã‚‹ã ã‘ã§ã™ã€‚å…¬å¼ãŒã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’æä¾›ã—ã¦ã„ã‚‹ã®ã§ãã®ã¾ã¾ä½¿ç”¨ã™ã‚Œã°ä½¿ãˆã¾ã™ã€‚ã‚ã¨ã¯ãŠå¥½ã¿ã«promtã‚’å¤‰ãˆã‚‹ã ã‘ã§ã™ã­ã€‚
ãã‚Œã§ã¯ã¿ãªã•ã‚“ã‚‚æ¥½ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæ´»ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚

```python
import torch
import torchaudio
from einops import rearrange
from stable_audio_tools import get_pretrained_model
from stable_audio_tools.inference.generation import generate_diffusion_cond

device = "cuda" if torch.cuda.is_available() else "cpu"

# Download model
model, model_config = get_pretrained_model("stabilityai/stable-audio-open-1.0")
sample_rate = model_config["sample_rate"]
sample_size = model_config["sample_size"]

model = model.to(device)
prompt = "128 BPM tech house drum loop"
# Set up text and timing conditioning
conditioning = [{
    "prompt": prompt,
    "seconds_start": 0, 
    "seconds_total": 47
}]

# Generate stereo audio
output = generate_diffusion_cond(
    model,
    steps=100,
    cfg_scale=7,
    conditioning=conditioning,
    sample_size=sample_size,
    sigma_min=0.3,
    sigma_max=500,
    sampler_type="dpmpp-3m-sde",
    device=device
)

# Rearrange audio batch to a single sequence
output = rearrange(output, "b d n -> d (b n)")

# Peak normalize, clip, convert to int16, and save to file
output = output.to(torch.float32).div(torch.max(torch.abs(output))).clamp(-1, 1).mul(32767).to(torch.int16).cpu()
torchaudio.save(prompt+".wav", output, sample_rate)
```