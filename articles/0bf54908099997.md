---
title: "WSL2ã§Music Transfomerå®Ÿè¡Œç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
emoji: "ğŸ‘‹"
type: "tech"
topics:
  - "tensorflow"
  - "wsl2"
  - "magenta"
  - "musictransfomer"
  - "tensor2tensor"
published: true
published_at: "2023-05-04 11:42"
---

# ã¯ã˜ã‚ã«
åˆæŠ•ç¨¿ã§ã™ã€‚éŸ³æ¥½ã‚’ç”Ÿæˆã™ã‚‹AIã«èˆˆå‘³ã‚’æŒã¡ã€æ¥ãšã‹ã—ãªãŒã‚‰æœ€è¿‘ã«ãªã£ã¦Music Transfomerã«ã¤ã„ã¦çŸ¥ã‚Šã¾ã—ãŸã€‚Music Transfomerã‚’WSL2ã§å®Ÿéš›ã«å‹•ã‹ã™ã¾ã§ã«ã‹ãªã‚Šæ‰‹é–“å–ã£ãŸã®ã§ã€å‚™å¿˜éŒ²ã¨ã—ã¦è¨˜è¼‰ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# ç›®çš„
Googleå…¬å¼ã®Music Transfomerã¯[ã“ã¡ã‚‰ã®URL](https://colab.research.google.com/notebooks/magenta/piano_transformer/piano_transformer.ipynb)ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ãŒã€2023å¹´4æœˆç¾åœ¨ã€magentaãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã®å¤‰åŒ–ã«ã‚ˆã‚Šã€å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚ã€€ã€€
ãã“ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®WSL2ç’°å¢ƒã«magentaã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã€AIä½œæ›²ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚ï¼ˆæœ¬è¨˜äº‹ã§ã¯Music Transfomerã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¾ã§ã‚’è¨˜è¼‰ï¼‰

# ç’°å¢ƒ
WSL2ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚
ãƒ›ã‚¹ãƒˆOS: Windows11
WSL2: 5.10.16.3-microsoft-standard-WSL2(Ubuntu 20.04)
CPU: 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz   2.30 GHz
GPU: NVIDIAã‚°ãƒ©ãƒœã‚’æ­è¼‰ã—ã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯CPUã§å®Ÿè¡Œã—ã¾ã™ã€‚ï¼ˆã†ã¾ãWSL2ç’°å¢ƒã§GPUã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ããªã‹ã£ãŸï¼‰

## WSL2ä¸Šã¸ã®magentaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»¥ä¸‹ã®magentaã®ãƒªãƒã‚¸ãƒˆãƒªã®README.mdã«ã‚ã‚‹ã‚ˆã†ã«ã€Anacondaã®ä»®æƒ³ç’°å¢ƒä¸Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã®ã§ã€ãã¡ã‚‰ã«å¾“ã£ã¦ã€Anacondaã«ä»®æƒ³ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚
- [magentaå…¬å¼GitHubãƒªãƒã‚¸ãƒˆãƒª](https://github.com/magenta/magenta)


ãªãŠã€Anacondaã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¾ã§ã®æ‰‹é †ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

- https://qiita.com/burugaria7/items/4005724c5d1b5228327e

ã¾ãšã¯magentaã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
$ sudo apt update
$ sudo apt install build-essential libasound2-dev libjack-dev portaudio19-dev
```
ãã®å¾ŒAnacondaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
$ wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh
$ bash Anaconda3-2022.05-Linux-x86_64.sh
$ source ~/.bashrc
```
æ¬¡ã«magentaã®å…¬å¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€magentaã®ä»®æƒ³ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
```
$ curl https://raw.githubusercontent.com/tensorflow/magenta/main/magenta/tools/magenta-install.sh > /tmp/magenta-install.sh
$ bash /tmp/magenta-install.sh
```
æ­£å¸¸ã«å®Ÿè¡Œå‡ºæ¥ãŸã‚‰ä¸€åº¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‰ã˜ã€å†åº¦é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§magentaä»®æƒ³ç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™ã€‚
```
$ source activate magenta
```
ãã®å¾Œã€magentaãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã€magentaã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’pipã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚
```
$ git clone https://github.com/magenta/magenta.git
$ cd magenta 
$ pip install -e .
```
ã‚¨ãƒ©ãƒ¼ãªãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚Œã°ã²ã¨ã¾ãšmagentaã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å®Œäº†ã§ã™ã€‚ãŸã ã—ã€æœ€æ–°ã®magentaã®çŠ¶æ…‹ã ã¨ã€[gansynth](https://github.com/magenta/magenta/tree/main/magenta/models/gansynth)ã‚„ã€[music_vae](https://github.com/magenta/magenta/tree/main/magenta/models/music_vae)ã¯å®Ÿè¡Œã§ããŸã‚‚ã®ã®ã€Music Transfomerã‚’ä½¿ç”¨ã—ãŸ[Score2Perf](https://github.com/magenta/magenta/tree/main/magenta/models/score2perf)ãŒå®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã¡ãªã¿ã«æœ€æ–°ã®magentaãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`2.1.4`ã§ã™ã€‚


ãã“ã§magentaãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã€Music TransfomerãŒå‹•ãç’°å¢ƒã¾ã§ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã›ãŸã¨ã„ã†ã‚ã‘ã§ã™ã€‚ï¼ˆé€†ã«æœ€æ–°ã®magentaãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å‹•ãã®ã§ã‚ã‚‹å ´åˆã€ç„¡ç†ã«ä»¥ä¸‹ã®å‡¦ç½®ã¯å®Ÿæ–½ã—ãªã„ã»ã†ãŒè‰¯ã„ã§ã™ã€‚ï¼‰

## magentaã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
ã•ã¦ã€ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã„ã‚ã‘ã§ã™ãŒã€ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¾ã§ä¸‹ã’ã‚Œã°ã‚ˆã„ã®ã‹ã€tensorflowã€tensor2tensorã¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ãªã©ã®ç¸›ã‚Šã‚‚ãã¤ãã€ã‹ãªã‚Šé›£èˆªã—ã¾ã—ãŸã€‚æœ€çµ‚çš„ã«å‚è€ƒã«ã—ãŸã®ã¯ã€ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚
- https://github.com/Elvenson/piano_transformer

ã“ã¡ã‚‰ã§Music TransfomerãŒ`1.3.1`ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€[requirements.txt](https://github.com/Elvenson/piano_transformer/blob/master/requirements.txt)ã§tensorflowãªã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ãŸã®ã§ã€ã“ã¡ã‚‰ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆã‚ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã—ãŸã€‚

ã¾ãšã¯ã€tensorflow`1.15.2`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
$ pip install tensorflow==1.15.2
```
æ¬¡ã«magenta`1.3.1`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
pip install magenta==1.3.1
```
æ¬¡ã« tensor2tensor`1.15.5`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
 pip install tensor2tensor==1.15.5
```
æ¬¡ã«tensorflow-probability`0.7.0`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
 pip install tensorflow-probability==0.7.0
```
æ¬¡ã«tensorflow-datasets`3.0.0`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
pip install tensorflow-datasets==3.0.0
```
æœ€å¾Œã«numpy`1.19.5`ã¸ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
```
pip install pip install numpy==1.19.5
```
ä»¥ä¸Šã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è¡Œã£ãŸã¨ã“ã‚ã€Music Transfomerã‚’ä½¿ç”¨ã—ãŸAIä½œæ›²ãŒã§ãã¾ã—ãŸã€‚
ä¸€å¿œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¾å­˜é–¢ä¿‚ã«å•é¡ŒãŒãªã„ã‹ã¯ãƒã‚§ãƒƒã‚¯ã—ãŸã»ã†ãŒè‰¯ã„ã§ã™ã€‚
```
$ pip check
No broken requirements found.
```
## pipä¸€è¦§
ä¸€å¿œMusic Transfomerã‚’å‹•ã‹ã™ã“ã¨ãŒã§ããŸpipã®ä¸€è¦§ã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚
```
absl-py==1.2.0
apache-beam==2.18.0
astor==0.8.1
astunparse==1.6.3
attrs==23.1.0
audioread==3.0.0
avro-python3==1.10.2
backcall==0.2.0
backports.tempfile==1.0
backports.weakref==1.0.post1
bokeh==2.4.3
bz2file==0.98
cachetools==3.1.1
certifi @ file:///croot/certifi_1671487769961/work/certifi
cffi==1.15.1
charset-normalizer==3.1.0
click==8.1.3
cloudpickle==1.2.2
contextlib2==21.6.0
crcmod==1.7
cycler==0.11.0
decorator==5.1.1
dill==0.3.1.1
dm-sonnet==1.35
dm-tree==0.1.8
docopt==0.6.2
dopamine-rl==3.0.1
etils==0.9.0
fastavro==0.21.24
fasteners==0.18
Flask==2.2.5
flatbuffers==1.12
fonttools==4.38.0
future==0.18.3
gast==0.2.2
gevent==22.10.2
gin-config==0.5.0
google-api-core==1.34.0
google-api-python-client==1.12.2
google-apitools==0.5.28
google-auth==1.35.0
google-auth-httplib2==0.0.4
google-auth-oauthlib==0.4.6
google-cloud-bigquery==1.17.1
google-cloud-bigtable==1.0.0
google-cloud-core==1.7.3
google-cloud-datastore==1.7.4
google-cloud-pubsub==1.0.2
google-pasta==0.2.0
google-resumable-media==0.4.1
googleapis-common-protos==1.59.0
greenlet==2.0.2
grpc-google-iam-v1==0.12.6
grpcio==1.54.0
grpcio-status==1.48.2
gunicorn==20.1.0
gym==0.14.0
gym-notices==0.0.8
h5py==3.8.0
hdfs==2.7.0
httplib2==0.12.0
idna==3.4
imageio==2.20.0
importlib-metadata==6.6.0
importlib-resources==5.12.0
install==1.3.5
intervaltree==3.1.0
ipython==7.34.0
itsdangerous==2.1.2
jedi==0.18.2
Jinja2==3.1.2
joblib==1.2.0
keras==2.9.0
Keras-Applications==1.0.8
Keras-Preprocessing==1.1.2
kfac==0.2.0
kiwisolver==1.4.4
libclang==16.0.0
librosa==0.7.2
llvmlite==0.32.1
magenta==1.3.1
Markdown==3.4.3
MarkupSafe==2.1.2
matplotlib==3.5.2
matplotlib-inline==0.1.6
mesh-tensorflow==0.1.21
mido==1.2.6
mir-eval==0.7
mock==2.0.0
mpmath==1.3.0
networkx==2.6.3
note-seq==0.0.3
numba==0.49.1
numpy==1.19.5
oauth2client==3.0.0
oauthlib==3.2.2
opencv-python==4.7.0.72
opt-einsum==3.3.0
packaging==23.1
pandas==1.3.5
parso==0.8.3
pbr==5.11.1
pexpect==4.8.0
pickleshare==0.7.5
Pillow==9.2.0
pretty-midi==0.2.9
promise==2.3
prompt-toolkit==3.0.38
protobuf==3.19.6
psutil==5.9.5
ptyprocess==0.7.0
pyarrow==0.15.1
pyasn1==0.5.0
pyasn1-modules==0.3.0
pycparser==2.21
pydot==1.4.2
pydub==0.25.1
pyglet==1.3.2
Pygments==2.15.1
pygtrie==2.5.0
pymongo==3.13.0
pyparsing==3.0.9
pypng==0.20220715.0
python-dateutil==2.8.2
python-rtmidi==1.1.2
pytz==2023.3
PyWavelets==1.3.0
PyYAML==6.0
requests==2.29.0
requests-oauthlib==1.3.1
resampy==0.3.1
rsa==4.9
scikit-image==0.19.3
scikit-learn==1.0.2
scipy==1.7.3
semantic-version==2.10.0
six==1.16.0
sk-video==1.1.10
sortedcontainers==2.4.0
soundfile==0.12.1
sox==1.4.1
sympy==1.10.1
tabulate==0.9.0
tensor2tensor==1.15.5
tensorboard==1.15.0
tensorboard-data-server==0.6.1
tensorboard-plugin-wit==1.8.1
tensorflow==1.15.2
tensorflow-addons==0.19.0
tensorflow-datasets==3.0.0
tensorflow-estimator==1.15.1
tensorflow-gan==2.1.0
tensorflow-hub==0.13.0
tensorflow-io-gcs-filesystem==0.32.0
tensorflow-metadata==1.12.0
tensorflow-probability==0.7.0
termcolor==2.3.0
tf-slim==1.1.0
tfds-nightly==4.8.2.dev202301270045
threadpoolctl==3.1.0
tifffile==2021.11.2
toml==0.10.2
tornado==6.2
tqdm==4.65.0
traitlets==5.9.0
typeguard==3.0.2
typing_extensions==4.5.0
uritemplate==3.0.1
urllib3==1.26.15
wcwidth==0.2.6
Werkzeug==2.2.3
wrapt==1.15.0
zipp==3.15.0
zope.event==4.6
zope.interface==6.0
```

# çµ‚ã‚ã‚Šã«
ä»Šå›ã¯åˆæŠ•ç¨¿ã¨ã„ã†ã“ã¨ã§ã€magentaã®Music Transfomerã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¾ã—ãŸã€‚
æ¬¡å›ã¯ã“ã¡ã‚‰ã®ä»®æƒ³ç’°å¢ƒã‚’ä½¿ç”¨ã—ã¦AIä½œæ›²ã™ã‚‹ã¾ã§ã‚’æ›¸ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚